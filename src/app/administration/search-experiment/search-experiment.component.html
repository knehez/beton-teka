<p-card>
  <h3>Kísérlet keresése</h3>
  <small>Írja be a keresni kívánt kísérlet azonosítóját:</small>

  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="inputGroup-sizing-default">Keresés</span>
    </div>
    <input type="text" [(ngModel)]="experimentName" class="form-control" aria-label="Default"
      aria-describedby="inputGroup-sizing-default">
  </div>
  <button type="button" class="btn btn-outline-primary" (click)="searchExperiment()">Keresés</button>
</p-card>
<p-card *ngIf="experiments.length > 0" styleClass="mt-2">
  <div class="container">

    <div class="row">
      <div class="col-md-10">
        <p-table [columns]="headColumns" [value]="experiments" [paginator]="true" [rows]="5" selectionMode=""
          [(selection)]="selectedExperiments">
          <ng-template pTemplate="header" let-columns>
            <tr>
              <th>
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="!col.hidden">{{col.header}}</th>
              </ng-container>
              <th>
                Műveletek
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
            <tr [pSelectableRow]="rowData">
              <td>
                <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
              </td>
              <ng-container *ngFor="let col of columns">
                <td *ngIf="!col.hidden" class="line-break">{{rowData[col.field]}}</td>
              </ng-container>
              <td>
                <button class="btn btn-sm btn-primary" (click) = "navigateToEdit(rowData.experimentName)">Szerkesztés</button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div class="col-md-2">
        <div *ngIf="selectedExperiments.length > 0">
          Nyomtatásra kijelölt kísérletek:
          <ul>
            <li *ngFor="let experiment of selectedExperiments">
              {{ experiment.experimentName }}
            </li>
          </ul>
          <button class="btn btn-primary" (click)="showPrintTemplate()">Nyomtatási kép</button>
        </div>
      </div>
    </div>
  </div>
</p-card>

<div #printTemplateSection>
  <p-card *ngIf="printTemplateVisible" styleClass="mt-2">

    <div class="container">
      <div class="row">
        <div class="col-md-10">
          <h4>Nyomtatási előnézet</h4>
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary" printSectionId="print-section" printTitle="Mérési jegyzőkönyv"
            [useExistingCss]="true" ngxPrint>Nyomtatás</button>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-12">
          <div id="print-section">
            <div *ngFor="let experiment of experimentsToPrint">
              <table class="table table-striped table-bordered table-sm mt-4">
                <tr>
                  <th>Kísérlet azonosító</th>
                  <th>Vizsgálat dátuma</th>
                </tr>
                <tr>
                  <td>{{ experiment.experimentName }}</td>
                  <td>{{ experiment.date }}</td>
                </tr>
                <tr>
                  <th>Méréstípusok</th>
                  <th>Adalékok</th>
                </tr>
                <tr>
                  <td>
                    <ul>
                      <li *ngFor="let measurementType of experiment.measurementTypes">
                        {{ measurementType }}
                      </li>
                    </ul>
                  </td>
                  <td>
                    <ul>
                      <li *ngFor="let add of experiment.adds">
                        {{add.quantity}} {{ add.unit }} {{ add.name }}
                      </li>
                    </ul>
                  </td>
                </tr>
                <tr>
                  <th colspan="2">Leírás</th>
                </tr>
                <tr>
                  <td class="line-break" colspan="2">
                    {{ experiment.description }}
                  </td>
                </tr>
                <tr>
                  <th colspan="2">Mérések</th>
                </tr>
                <tr>
                  <td colspan="2">
                    <ul>
                      <li *ngFor="let measurementGroup of experiment.measurements | keyvalue">
                        {{ experiment.experimentName }}-{{ measurementGroup.key }}:
                        <ul>
                          <li *ngFor="let measurement of measurementGroup.value">
                            {{ measurement.measurementType.name }}:
                            <ul>
                              <li *ngFor="let measurementData of measurement.measurementData.data">
                                {{ measurementData.name }}: {{ measurementData.value }} {{ measurementData.unit }}
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </p-card>
</div>